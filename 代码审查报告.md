# AI é‡æ„ä»£ç å®¡æŸ¥æŠ¥å‘Š

## ğŸ“‹ å®¡æŸ¥é—®é¢˜

1. **BaseAIService.ts å’Œ BaseHTTPClient.ts æ˜¯å¦éœ€è¦ç§»åŠ¨åˆ° ai æ–‡ä»¶å¤¹ï¼Ÿ**
2. **æ˜¯å¦å­˜åœ¨å†—ä½™ä»£ç ï¼Ÿ**

---

## ğŸ” åˆ†æç»“æœ

### 1. BaseAIService.ts å’Œ BaseHTTPClient.ts

#### å½“å‰ä½ç½®
```
src/services/
â”œâ”€â”€ BaseAIService.ts      # AI æœåŠ¡åŸºç±»
â”œâ”€â”€ BaseHTTPClient.ts     # HTTP å®¢æˆ·ç«¯åŸºç±»
â””â”€â”€ ai/                   # AI æœåŠ¡æ¨¡å—
    â”œâ”€â”€ types.ts
    â”œâ”€â”€ AIServiceRegistry.ts
    â”œâ”€â”€ AIServiceManager.ts
    â””â”€â”€ [7ä¸ªå…·ä½“æœåŠ¡]
```

#### ä½¿ç”¨æƒ…å†µåˆ†æ

**BaseAIService.ts è¢«ä»¥ä¸‹æ–‡ä»¶ä½¿ç”¨**ï¼š
- âœ… `ai/OpenAIService.ts` - ç»§æ‰¿
- âœ… `ai/AnthropicService.ts` - ç»§æ‰¿
- âœ… `ai/GeminiService.ts` - ç»§æ‰¿
- âœ… `ai/DeepseekService.ts` - ç»§æ‰¿
- âœ… `ai/SiliconFlowService.ts` - ç»§æ‰¿
- âœ… `ai/AIServiceRegistry.ts` - å¯¼å…¥ç±»å‹
- âœ… `ai/factories.ts` - å¯¼å…¥ç±»å‹
- âœ… `settings/ai/*Settings.ts` - å¯¼å…¥ç±»å‹ï¼ˆ8ä¸ªæ–‡ä»¶ï¼‰

**BaseHTTPClient.ts è¢«ä»¥ä¸‹æ–‡ä»¶ä½¿ç”¨**ï¼š
- âœ… `BaseAIService.ts` - ä½¿ç”¨
- âœ… `ai/CustomAIService.ts` - ä½¿ç”¨
- âœ… `ai/SiliconFlowService.ts` - ä½¿ç”¨

#### å»ºè®®ï¼š**åº”è¯¥ç§»åŠ¨åˆ° ai æ–‡ä»¶å¤¹** âœ…

**ç†ç”±**ï¼š
1. **èŒè´£æ˜ç¡®** - è¿™ä¸¤ä¸ªç±»ä¸“é—¨ä¸º AI æœåŠ¡è®¾è®¡
2. **æ¨¡å—å†…èš** - æ‰€æœ‰ AI ç›¸å…³ä»£ç åº”è¯¥åœ¨ä¸€ä¸ªæ¨¡å—å†…
3. **ä¾èµ–å…³ç³»** - ä¸»è¦è¢« ai æ¨¡å—å†…çš„æ–‡ä»¶ä½¿ç”¨
4. **æœªæ¥æ‰©å±•** - å¦‚æœæœ‰é AI çš„ HTTP éœ€æ±‚ï¼Œå¯ä»¥åˆ›å»ºé€šç”¨çš„ HTTPClient

**ç§»åŠ¨æ–¹æ¡ˆ**ï¼š
```
src/services/ai/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ BaseAIService.ts      # ç§»åŠ¨åˆ°è¿™é‡Œ
â”‚   â””â”€â”€ BaseHTTPClient.ts     # ç§»åŠ¨åˆ°è¿™é‡Œ
â”œâ”€â”€ types.ts
â”œâ”€â”€ AIServiceRegistry.ts
â”œâ”€â”€ AIServiceManager.ts
â”œâ”€â”€ factories.ts
â”œâ”€â”€ index.ts
â””â”€â”€ [7ä¸ªæœåŠ¡æ–‡ä»¶]
```

æˆ–è€…æ›´ç®€å•ï¼š
```
src/services/ai/
â”œâ”€â”€ BaseAIService.ts          # ç›´æ¥ç§»åŠ¨åˆ° ai æ–‡ä»¶å¤¹
â”œâ”€â”€ BaseHTTPClient.ts         # ç›´æ¥ç§»åŠ¨åˆ° ai æ–‡ä»¶å¤¹
â”œâ”€â”€ types.ts
â”œâ”€â”€ AIServiceRegistry.ts
â””â”€â”€ ...
```

---

### 2. å†—ä½™ä»£ç æ£€æŸ¥

#### âœ… å·²åˆ é™¤çš„å†—ä½™ä»£ç 

1. **æ—§çš„ AIService.ts** (419è¡Œ) - âœ… å·²åˆ é™¤
2. **æ—§çš„æœåŠ¡æ–‡ä»¶** (7ä¸ª) - âœ… å·²åˆ é™¤
   - AnthropicService.ts
   - GeminiService.ts
   - DeepseekService.ts
   - SiliconFlowService.ts
   - OllamaService.ts
   - CustomAIService.ts

#### âš ï¸ å‘ç°çš„æ½œåœ¨å†—ä½™

##### 1. ç±»å‹å®šä¹‰é‡å¤

**é—®é¢˜**ï¼š`AIModel` ç±»å‹åœ¨å¤šå¤„å®šä¹‰

**ä½ç½®**ï¼š
- `src/types.ts` - å®šä¹‰äº† `AIModel`
- `src/services/ai/types.ts` - ä¹Ÿå®šä¹‰äº† `AIModel`

**æ£€æŸ¥**ï¼š
```typescript
// src/types.ts
export interface AIModel {
    id: string;
    name: string;
    isCustom?: boolean;
}

// src/services/ai/types.ts
export interface AIModel {
    id: string;
    name: string;
    isCustom?: boolean;
}
```

**å»ºè®®**ï¼š
- ä¿ç•™ `ai/types.ts` ä¸­çš„å®šä¹‰
- ä» `src/types.ts` ä¸­åˆ é™¤ï¼Œæ”¹ä¸ºé‡æ–°å¯¼å‡º
- æˆ–è€…åœ¨ `src/types.ts` ä¸­é‡æ–°å¯¼å‡º AI æ¨¡å—çš„ç±»å‹

##### 2. å¯¼å…¥è·¯å¾„ä¸ä¸€è‡´

**é—®é¢˜**ï¼šæœ‰äº›æ–‡ä»¶ä» `../types` å¯¼å…¥ï¼Œæœ‰äº›ä» `../services/ai` å¯¼å…¥

**å»ºè®®**ï¼šç»Ÿä¸€å¯¼å…¥è·¯å¾„ï¼Œæ‰€æœ‰ AI ç›¸å…³ç±»å‹éƒ½ä» `services/ai` å¯¼å…¥

##### 3. è®¾ç½®æ–‡ä»¶ä¸­çš„æµ‹è¯•ä»£ç 

**ä½ç½®**ï¼š`settings/ai/*Settings.ts` æ–‡ä»¶ä¸­æœ‰è¿æ¥æµ‹è¯•ä»£ç 

**æ£€æŸ¥æ˜¯å¦é‡å¤**ï¼šæ¯ä¸ªè®¾ç½®æ–‡ä»¶éƒ½æœ‰ç±»ä¼¼çš„æµ‹è¯•é€»è¾‘

**å»ºè®®**ï¼šå¯ä»¥æå–ä¸ºå…¬å…±çš„æµ‹è¯•å·¥å…·å‡½æ•°

---

## ğŸ“Š å½“å‰ services ç›®å½•ç»“æ„

```
src/services/
â”œâ”€â”€ ai/                          # AI æœåŠ¡æ¨¡å—ï¼ˆæ–°ï¼‰
â”‚   â”œâ”€â”€ types.ts                 # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ AIServiceRegistry.ts     # æœåŠ¡æ³¨å†Œè¡¨
â”‚   â”œâ”€â”€ AIServiceManager.ts      # æœåŠ¡ç®¡ç†å™¨
â”‚   â”œâ”€â”€ factories.ts             # å·¥å‚ç±»
â”‚   â”œâ”€â”€ index.ts                 # ç»Ÿä¸€å¯¼å‡º
â”‚   â”œâ”€â”€ OpenAIService.ts         # OpenAI æœåŠ¡
â”‚   â”œâ”€â”€ AnthropicService.ts      # Anthropic æœåŠ¡
â”‚   â”œâ”€â”€ GeminiService.ts         # Gemini æœåŠ¡
â”‚   â”œâ”€â”€ DeepseekService.ts       # Deepseek æœåŠ¡
â”‚   â”œâ”€â”€ SiliconFlowService.ts    # SiliconFlow æœåŠ¡
â”‚   â”œâ”€â”€ OllamaService.ts         # Ollama æœåŠ¡
â”‚   â””â”€â”€ CustomAIService.ts       # Custom æœåŠ¡
â”œâ”€â”€ BaseAIService.ts             # âš ï¸ å»ºè®®ç§»åŠ¨åˆ° ai/
â”œâ”€â”€ BaseHTTPClient.ts            # âš ï¸ å»ºè®®ç§»åŠ¨åˆ° ai/
â”œâ”€â”€ BlockIdService.ts            # âœ… é AI æœåŠ¡ï¼Œä¿ç•™
â”œâ”€â”€ CanvasService.ts             # âœ… é AI æœåŠ¡ï¼Œä¿ç•™
â”œâ”€â”€ ChatService.ts               # âœ… ä½¿ç”¨ AIï¼Œä½†ä¸æ˜¯ AI æœåŠ¡æœ¬èº«
â”œâ”€â”€ ContextService.ts            # âœ… é AI æœåŠ¡ï¼Œä¿ç•™
â”œâ”€â”€ EventManager.ts              # âœ… é AI æœåŠ¡ï¼Œä¿ç•™
â”œâ”€â”€ ExportService.ts             # âœ… é AI æœåŠ¡ï¼Œä¿ç•™
â”œâ”€â”€ HighlightService.ts          # âœ… é AI æœåŠ¡ï¼Œä¿ç•™
â”œâ”€â”€ InitializationManager.ts     # âœ… é AI æœåŠ¡ï¼Œä¿ç•™
â”œâ”€â”€ LicenseManager.ts            # âœ… é AI æœåŠ¡ï¼Œä¿ç•™
â”œâ”€â”€ LocationService.ts           # âœ… é AI æœåŠ¡ï¼Œä¿ç•™
â””â”€â”€ WindowManager.ts             # âœ… é AI æœåŠ¡ï¼Œä¿ç•™
```

---

## ğŸ¯ ä¼˜åŒ–å»ºè®®

### ç«‹å³æ‰§è¡Œï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

#### 1. ç§»åŠ¨ BaseAIService å’Œ BaseHTTPClient

**æ“ä½œæ­¥éª¤**ï¼š
```bash
# ç§»åŠ¨æ–‡ä»¶
mv src/services/BaseAIService.ts src/services/ai/
mv src/services/BaseHTTPClient.ts src/services/ai/

# æ›´æ–°å¯¼å…¥è·¯å¾„ï¼ˆéœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼‰
# - ai/OpenAIService.ts
# - ai/AnthropicService.ts
# - ai/GeminiService.ts
# - ai/DeepseekService.ts
# - ai/SiliconFlowService.ts
# - ai/CustomAIService.ts
# - ai/AIServiceRegistry.ts
# - ai/factories.ts
# - settings/ai/*Settings.ts (8ä¸ªæ–‡ä»¶)
```

**å¯¼å…¥è·¯å¾„å˜åŒ–**ï¼š
```typescript
// æ—§çš„
import { BaseAIService } from '../BaseAIService';
import { BaseHTTPClient } from '../BaseHTTPClient';

// æ–°çš„
import { BaseAIService } from './BaseAIService';
import { BaseHTTPClient } from './BaseHTTPClient';
```

#### 2. ç»Ÿä¸€ç±»å‹å®šä¹‰

**é€‰é¡¹ Aï¼šåœ¨ src/types.ts ä¸­é‡æ–°å¯¼å‡º**
```typescript
// src/types.ts
export { AIModel, AIProviderType, AIMessage } from './services/ai/types';
```

**é€‰é¡¹ Bï¼šåˆ é™¤ src/types.ts ä¸­çš„ AIModel**
```typescript
// ä» src/types.ts åˆ é™¤ AIModel å®šä¹‰
// æ‰€æœ‰ä½¿ç”¨ AIModel çš„åœ°æ–¹æ”¹ä¸ºä» services/ai å¯¼å…¥
```

**æ¨è**ï¼šé€‰é¡¹ Aï¼Œä¿æŒå‘åå…¼å®¹

### å¯é€‰æ‰§è¡Œï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

#### 3. æå–å…¬å…±æµ‹è¯•å·¥å…·

åˆ›å»º `src/services/ai/utils/testConnection.ts`ï¼š
```typescript
export async function testAIServiceConnection(
    service: IAIService,
    providerName: string
): Promise<boolean> {
    try {
        return await service.testConnection();
    } catch (error) {
        console.error(`${providerName} connection test failed:`, error);
        return false;
    }
}
```

#### 4. ä¼˜åŒ–å¯¼å‡ºç»“æ„

æ›´æ–° `src/services/ai/index.ts`ï¼š
```typescript
// å¯¼å‡ºæ‰€æœ‰æ ¸å¿ƒç±»å’Œç±»å‹
export { AIServiceManager } from './AIServiceManager';
export { AIServiceRegistry } from './AIServiceRegistry';
export { BaseAIService } from './BaseAIService';
export { BaseHTTPClient } from './BaseHTTPClient';

// å¯¼å‡ºæ‰€æœ‰ç±»å‹
export * from './types';

// å¯¼å‡ºæ‰€æœ‰æœåŠ¡ï¼ˆå¦‚æœéœ€è¦ç›´æ¥è®¿é—®ï¼‰
export * from './OpenAIService';
export * from './AnthropicService';
// ... å…¶ä»–æœåŠ¡
```

---

## ğŸ“ æ‰§è¡Œæ¸…å•

### ç¬¬ä¸€æ­¥ï¼šç§»åŠ¨åŸºç¡€ç±»ï¼ˆ15åˆ†é’Ÿï¼‰

- [ ] ç§»åŠ¨ BaseAIService.ts åˆ° ai/
- [ ] ç§»åŠ¨ BaseHTTPClient.ts åˆ° ai/
- [ ] æ›´æ–° ai/ å†…éƒ¨æ–‡ä»¶çš„å¯¼å…¥ï¼ˆ7ä¸ªæœåŠ¡æ–‡ä»¶ï¼‰
- [ ] æ›´æ–° ai/AIServiceRegistry.ts å¯¼å…¥
- [ ] æ›´æ–° ai/factories.ts å¯¼å…¥
- [ ] æ›´æ–° settings/ai/ ä¸‹çš„å¯¼å…¥ï¼ˆ8ä¸ªæ–‡ä»¶ï¼‰
- [ ] ç¼–è¯‘æµ‹è¯•

### ç¬¬äºŒæ­¥ï¼šç»Ÿä¸€ç±»å‹å®šä¹‰ï¼ˆ5åˆ†é’Ÿï¼‰

- [ ] åœ¨ src/types.ts ä¸­é‡æ–°å¯¼å‡º AI ç±»å‹
- [ ] æˆ–åˆ é™¤é‡å¤çš„ç±»å‹å®šä¹‰
- [ ] ç¼–è¯‘æµ‹è¯•

### ç¬¬ä¸‰æ­¥ï¼šä¼˜åŒ–å¯¼å‡ºï¼ˆå¯é€‰ï¼Œ5åˆ†é’Ÿï¼‰

- [ ] æ›´æ–° ai/index.ts
- [ ] æ›´æ–°ç›¸å…³å¯¼å…¥
- [ ] ç¼–è¯‘æµ‹è¯•

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

### ç§»åŠ¨åçš„ç»“æ„
```
src/services/ai/              # å®Œæ•´çš„ AI æ¨¡å—
â”œâ”€â”€ BaseAIService.ts          # âœ… ç§»åŠ¨åˆ°è¿™é‡Œ
â”œâ”€â”€ BaseHTTPClient.ts         # âœ… ç§»åŠ¨åˆ°è¿™é‡Œ
â”œâ”€â”€ types.ts                  # ç±»å‹å®šä¹‰
â”œâ”€â”€ AIServiceRegistry.ts      # æœåŠ¡æ³¨å†Œè¡¨
â”œâ”€â”€ AIServiceManager.ts       # æœåŠ¡ç®¡ç†å™¨
â”œâ”€â”€ factories.ts              # å·¥å‚ç±»
â”œâ”€â”€ index.ts                  # ç»Ÿä¸€å¯¼å‡º
â””â”€â”€ [7ä¸ªæœåŠ¡æ–‡ä»¶]
```

### ä¼˜åŠ¿
1. **æ¨¡å—å®Œæ•´æ€§** - æ‰€æœ‰ AI ç›¸å…³ä»£ç åœ¨ä¸€ä¸ªæ¨¡å—
2. **æ¸…æ™°çš„è¾¹ç•Œ** - AI æ¨¡å—è‡ªåŒ…å«
3. **æ˜“äºç»´æŠ¤** - ç›¸å…³ä»£ç åœ¨ä¸€èµ·
4. **æ˜“äºæµ‹è¯•** - æ¨¡å—ç‹¬ç«‹æ€§å¼º
5. **æ˜“äºå¤ç”¨** - å¯ä»¥ä½œä¸ºç‹¬ç«‹æ¨¡å—ä½¿ç”¨

---

## ğŸ’¡ æ€»ç»“

### å›ç­”ä½ çš„é—®é¢˜

1. **BaseAIService.ts å’Œ BaseHTTPClient.ts æœ‰ç”¨å—ï¼Ÿ**
   - âœ… **éå¸¸æœ‰ç”¨**ï¼å®ƒä»¬æ˜¯æ•´ä¸ª AI æ¶æ„çš„åŸºç¡€
   - BaseAIService æä¾›ç»Ÿä¸€çš„æœåŠ¡æ¥å£å’Œé€šç”¨åŠŸèƒ½
   - BaseHTTPClient æä¾›ç»Ÿä¸€çš„ HTTP è¯·æ±‚å¤„ç†

2. **éœ€è¦ç§»åŠ¨åˆ° ai æ–‡ä»¶å¤¹å—ï¼Ÿ**
   - âœ… **å¼ºçƒˆå»ºè®®ç§»åŠ¨**
   - ç†ç”±ï¼šæ¨¡å—å†…èšã€èŒè´£æ˜ç¡®ã€ä¾èµ–å…³ç³»æ¸…æ™°
   - å·¥ä½œé‡ï¼šçº¦ 15-20 åˆ†é’Ÿ

3. **æœ‰å†—ä½™ä»£ç å—ï¼Ÿ**
   - âœ… **ä¸»è¦å†—ä½™å·²æ¸…ç†**ï¼ˆåˆ é™¤äº† 419 è¡Œçš„æ—§ä»£ç ï¼‰
   - âš ï¸ **è½»å¾®å†—ä½™**ï¼šAIModel ç±»å‹å®šä¹‰é‡å¤
   - ğŸ’¡ **ä¼˜åŒ–ç©ºé—´**ï¼šå¯ä»¥æå–å…¬å…±æµ‹è¯•å·¥å…·

### å»ºè®®è¡ŒåŠ¨

**ç«‹å³æ‰§è¡Œ**ï¼š
1. ç§»åŠ¨ BaseAIService.ts å’Œ BaseHTTPClient.ts åˆ° ai/
2. æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„
3. ç»Ÿä¸€ç±»å‹å®šä¹‰

**å¯é€‰ä¼˜åŒ–**ï¼š
1. æå–å…¬å…±æµ‹è¯•å·¥å…·
2. ä¼˜åŒ–å¯¼å‡ºç»“æ„

**é¢„è®¡æ—¶é—´**ï¼š20-30 åˆ†é’Ÿ
**æ”¶ç›Š**ï¼šæ¨¡å—ç»“æ„æ›´æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
